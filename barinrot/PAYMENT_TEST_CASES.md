# מקרי בדיקה לזיהוי תשלום / Payment Detection Test Cases

## ✅ מקרים שצריכים לזהות כתשלום / Should Detect as Payment

| הודעה | הסבר | תוצאה צפויה |
|-------|------|-------------|
| שילמתי | אישור ישיר | ✅ זיהוי תשלום |
| כן שילמתי | אישור עם "כן" | ✅ זיהוי תשלום |
| שולם | אישור קצר | ✅ זיהוי תשלום |
| ביצעתי תשלום | אישור פורמלי | ✅ זיהוי תשלום |
| הכסף הועבר | אישור עקיף | ✅ זיהוי תשלום |
| התשלום בוצע | אישור פורמלי | ✅ זיהוי תשלום |
| כבר שילמתי | אישור עם הדגשה | ✅ זיהוי תשלום |
| עברתי תשלום | אישור פעולה | ✅ זיהוי תשלום |
| שלחתי את הכסף | אישור שליחה | ✅ זיהוי תשלום |
| סיימתי את התשלום | אישור השלמה | ✅ זיהוי תשלום |
| עשיתי תשלום | אישור פעולה | ✅ זיהוי תשלום |
| תשלמתי (טעות כתיב) | שגיאת הקלדה נפוצה | ✅ זיהוי תשלום |

---

## ❌ מקרים שלא צריכים לזהות כתשלום / Should NOT Detect as Payment

### שאלות / Questions
| הודעה | הסבר | תוצאה צפויה |
|-------|------|-------------|
| מה אם שילמתי כבר בעבר? | שאלה היפותטית | ❌ לא תשלום |
| האם אני צריך לשלם? | שאלת הבהרה | ❌ לא תשלום |
| מתי לשלם? | שאלת זמן | ❌ לא תשלום |
| כמה צריך לשלם? | שאלת מחיר | ❌ לא תשלום |
| איך משלמים? | שאלת הוראות | ❌ לא תשלום |
| אני צריך לשלם עכשיו? | שאלת אישור | ❌ לא תשלום |

### עתיד / Future Tense
| הודעה | הסבר | תוצאה צפויה |
|-------|------|-------------|
| אשלם מחר | כוונה עתידית | ❌ לא תשלום |
| אשלם עוד מעט | תכנון עתידי | ❌ לא תשלום |
| אעביר תשלום בערב | הבטחה עתידית | ❌ לא תשלום |
| אבצע את התשלום מאוחר יותר | דחייה | ❌ לא תשלום |

### סיפורים על עבר / Past Stories
| הודעה | הסבר | תוצאה צפויה |
|-------|------|-------------|
| פעם שילמתי למאמן אחר | סיפור לא רלוונטי | ❌ לא תשלום |
| בעבר כשהייתי במכון שילמתי 500 שקל | השוואת מחירים | ❌ לא תשלום |
| אני זוכר ששילמתי למישהו | זיכרון עמום | ❌ לא תשלום |

### התנגדויות / Objections
| הודעה | הסבר | תוצאה צפויה |
|-------|------|-------------|
| לא שילמתי עדיין | שלילה | ❌ לא תשלום |
| עוד לא שילמתי | עיכוב | ❌ לא תשלום |
| לא אשלם | סירוב | ❌ לא תשלום |
| זה יקר לשלם | התנגדות למחיר | ❌ לא תשלום |

### מילים מעורפלות / Unclear Words
| הודעה | הסבר | תוצאה צפויה |
|-------|------|-------------|
| סגרתי | לא ברור מה | ❌ לא תשלום |
| עדכן | ללא הקשר | ❌ לא תשלום |
| מוכן | מה מוכן? | ❌ לא תשלום |
| בוצע | מה בוצע? | ❌ לא תשלום |
| הכל בסדר | כללי מדי | ❌ לא תשלום |

### הודעות כלליות / General Messages
| הודעה | הסבר | תוצאה צפויה |
|-------|------|-------------|
| תודה | תודה רגילה | ❌ לא תשלום |
| אוקיי | הסכמה כללית | ❌ לא תשלום |
| מעולה | תגובה חיובית | ❌ לא תשלום |
| הבנתי | אישור הבנה | ❌ לא תשלום |

---

## 🧪 תסריט בדיקה מומלץ / Recommended Test Script

### בדיקה 1: תשלום פשוט
```
👤 משתמש: היי, אני רוצה לקבוע אימון
🤖 ג'ורג': [מנהל שיחה רגילה]
👤 משתמש: איך קוראים לי? אריאל
👤 משתמש: גיל 35
👤 משתמש: יש לי ניסיון בקראטה
🤖 ג'ורג': [מציע אימון ניסיון]
👤 משתמש: כן, יום חמישי מתאים
🤖 ג'ורג': [שולח קישור תשלום]
👤 משתמש: שילמתי ✅
🤖 ג'ורג': [אישור + פרטי הגעה]
```
**תוצאה צפויה**: דביר מקבל סיכום עם כל הפרטים

---

### בדיקה 2: שאלה עם "שילמתי"
```
👤 משתמש: היי
🤖 ג'ורג': [פתיחה]
👤 משתמש: מה אם שילמתי כבר בעבר? ❌
🤖 ג'ורג': [ממשיך שיחה רגילה, לא מזהה תשלום]
```
**תוצאה צפויה**: לא מזהה כתשלום, ממשיך שיחה

---

### בדיקה 3: אישור עם "שולם"
```
👤 משתמש: [אחרי קבלת קישור תשלום]
👤 משתמש: שולם ✅
🤖 ג'ורג': [אישור + פרטי הגעה]
```
**תוצאה צפויה**: זיהוי תשלום, שליחה לדביר

---

### בדיקה 4: עתיד
```
👤 משתמש: אשלם מחר ❌
🤖 ג'ורג': [ממשיך שיחה רגילה]
```
**תוצאה צפויה**: לא מזהה תשלום

---

### בדיקה 5: מילה מעורפלת
```
👤 משתמש: סגרתי ❌
🤖 ג'ורג': [ממשיך שיחה רגילה]
```
**תוצאה צפויה**: לא מזהה תשלום

---

## 📊 איך לבדוק במעבדה / Lab Testing

### שלב 1: הכנה
1. וודא ש-`server_new.js` רץ
2. פתח את הקונסול לצפייה בלוגים
3. פתח שיחת ווטסאפ או את הממשק הווב

### שלב 2: הרצת מקרי בדיקה
לכל מקרה בדיקה:

1. **שלח הודעה**
2. **בדוק בקונסול**:
   - האם זוהו מילות מפתח? (`🔍 זוהו מילות מפתח`)
   - מה GPT החליט? (`✅ GPT אישר` או `❌ GPT קבע`)
3. **בדוק תגובה**:
   - האם התקבלה הודעת אישור תשלום?
   - האם דביר קיבל סיכום?

### שלב 3: תיעוד
תעד כל מקרה שעובד/לא עובד כצפוי:

| הודעה | תוצאה בפועל | תוצאה צפויה | ✅/❌ |
|-------|-------------|-------------|------|
| שולם | זוהה כתשלום | זוהה כתשלום | ✅ |
| מה אם שילמתי | לא זוהה | לא זוהה | ✅ |
| ... | ... | ... | ... |

---

## 🐛 מה לעשות אם יש בעיה / Troubleshooting

### בעיה: "שולם" לא מזוהה
**תסמינים**: 
- לא מופיע `🔍 זוהו מילות מפתח`

**פתרון**:
1. בדוק ש-`georgePrompt.payment_detection.keywords_for_gpt_check` כולל "שילם"
2. הפעל מחדש את השרת

---

### בעיה: False Positive (זיהוי שגוי)
**תסמינים**:
- GPT מזהה תשלום גם בשאלה
- `✅ GPT אישר: זה תשלום` כשלא צריך

**פתרון**:
1. הוסף את הדוגמה הספציפית לפרומפט של GPT
2. שפר את ההוראות בשורות 474-479 ב-`server_new.js`

---

### בעיה: False Negative (לא מזהה תשלום אמיתי)
**תסמינים**:
- `❌ GPT קבע: זה לא תשלום` למרות שזה תשלום

**פתרון**:
1. בדוק את הקונטקסט - האם יש מספיק היסטוריה?
2. הוסף את הביטוי לדוגמאות החיוביות בפרומפט

---

### בעיה: דביר לא מקבל הודעה
**תסמינים**:
- `💰 תשלום אושר!` אבל אין `✅ סיכום נשלח לדביר`

**פתרון**:
1. בדוק שהמספר של דביר נכון: `972559925657@c.us`
2. בדוק שהווטסאפ מחובר (`isWhatsAppReady = true`)
3. בדוק את הלוגים לשגיאות בשליחה

---

## 📈 מדדי הצלחה / Success Metrics

### יעדים:
- ✅ **דיוק זיהוי**: 95%+ (כמעט אין false positives/negatives)
- ✅ **זמן תגובה**: < 2 שניות לזיהוי
- ✅ **שליחה לדביר**: 100% כשיש תשלום אמיתי
- ✅ **חווית משתמש**: אין שאלות מיותרות "האם שילמת?"

### איך למדוד:
1. הרץ 20 מקרי בדיקה
2. תעד תוצאות
3. חשב:
   - **Accuracy** = (True Positives + True Negatives) / Total Cases
   - **Precision** = True Positives / (True Positives + False Positives)
   - **Recall** = True Positives / (True Positives + False Negatives)

---

**הצלחה בבדיקות! 🚀**

תאריך: 5 באוקטובר 2025

