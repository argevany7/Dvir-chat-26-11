אני# בדיקת תכונת KILLALL/ACTIVATE

## תרחיש בדיקה 1: עצירה בסיסית

### צעדים:
1. שלח מהמנהל: `/killall`
2. ודא שהבוט שואל אישור
3. שלח: `כן`
4. ודא שהבוט מאשר שהוא עצור

### תוצאה צפויה:
```
מנהל: /killall
בוט:   ⛔ עצירת הבוט
       ─────────────────────────────
       
       ⚠️ פעולה זו תעצור את הבוט מלהגיב לכל הלקוחות!
       ...
       האם אתה בטוח?
       כן - לעצור את הבוט
       לא - לבטל
       ביטול - לבטל

מנהל: כן
בוט:   ⛔ הבוט הופסק בהצלחה
```

---

## תרחיש בדיקה 2: בדיקת אי-תגובה ללקוחות

### צעדים:
1. עצור את הבוט עם `/killall` → `כן`
2. שלח הודעה ממספר לקוח
3. ודא שהבוט **לא** מגיב

### תוצאה צפויה:
- ✅ הבוט לא שולח תשובה ללקוח
- ✅ בלוג מופיע: `⛔ הבוט במצב עצור - לא מגיב ל-[מספר] (אבל שומר את ההודעה)`

---

## תרחיש בדיקה 3: שמירת הודעות

### צעדים:
1. עצור את הבוט
2. שלח כמה הודעות ממספר לקוח
3. הפעל את הבוט עם `/activate`
4. שלח עוד הודעה מאותו לקוח

### תוצאה צפויה:
- ✅ ההודעות נשמרו ב-DB
- ✅ הבוט רואה את כל ההיסטוריה
- ✅ הבוט ממשיך את השיחה מהנקודה בה הפסיק

---

## תרחיש בדיקה 4: הפעלה מחדש

### צעדים:
1. עצור את הבוט
2. שלח מהמנהל: `/activate`
3. ודא שהבוט מאשר שהוא פעיל
4. שלח הודעה ממספר לקוח
5. ודא שהבוט מגיב

### תוצאה צפויה:
```
מנהל: /activate
בוט:   ✅ הבוט הופעל מחדש!
       
       🔹 הבוט חוזר להגיב לכל הלקוחות
       🔹 כל השיחות ממשיכות מהנקודה בה הן נעצרו
       
       הבוט פעיל ומוכן! 🚀
```

---

## תרחיש בדיקה 5: ביטול עצירה

### צעדים:
1. שלח: `/killall`
2. שלח: `לא` או `ביטול`
3. ודא שהבוט מבטל ונשאר פעיל
4. שלח הודעה ממספר לקוח
5. ודא שהבוט מגיב

### תוצאה צפויה:
```
מנהל: /killall
בוט:   [הודעת אישור]
מנהל: לא
בוט:   🔄 הפעולה בוטלה
       
       הבוט ממשיך לפעול כרגיל.
```

---

## תרחיש בדיקה 6: עצירה כפולה

### צעדים:
1. עצור את הבוט עם `/killall`
2. שלח שוב `/killall`
3. ודא שהבוט מודיע שהוא כבר עצור

### תוצאה צפויה:
```
מנהל: /killall
בוט:   ⚠️ הבוט כבר במצב עצור
       
       הבוט כרגע לא מגיב לאף לקוח.
       להפעלה מחדש שלח: /activate
```

---

## תרחיש בדיקה 7: הפעלה כפולה

### צעדים:
1. ודא שהבוט פעיל (או הפעל עם `/activate`)
2. שלח שוב `/activate`
3. ודא שהבוט מודיע שהוא כבר פעיל

### תוצאה צפויה:
```
מנהל: /activate
בוט:   ✅ הבוט כבר פעיל
       
       הבוט מגיב לכל הלקוחות כרגיל.
```

---

## תרחיש בדיקה 8: פקודות מנהל בזמן עצירה

### צעדים:
1. עצור את הבוט
2. שלח פקודות מנהל שונות: `/help`, `/check`, `/block`, וכו'
3. ודא שהבוט מגיב למנהל

### תוצאה צפויה:
- ✅ המנהל יכול לבצע כל פעולת ניהול
- ✅ רק לקוחות רגילים לא מקבלים תגובות

---

## תרחיש בדיקה 9: בדיקת לוג

### צעדים:
1. הפעל את השרת עם: `node server.js`
2. בצע תרחישים 1-8
3. בדוק את הלוגים בקונסול

### לוגים צפויים:
```
⛔ הבוט הופסק על ידי מנהל: [מספר]
⛔ הבוט במצב עצור - לא מגיב ל-[מספר] (אבל שומר את ההודעה)
✅ הבוט הופעל מחדש על ידי מנהל: [מספר]
```

---

## תרחיש בדיקה 10: בדיקת DB

### צעדים:
1. עצור את הבוט
2. שלח 3 הודעות ממספר לקוח
3. בדוק את ה-DB:
   ```bash
   sqlite3 dvir_basson_clients.db "SELECT * FROM conversations WHERE client_phone='[מספר]' ORDER BY timestamp DESC LIMIT 3"
   ```
4. ודא שההודעות נשמרו

### תוצאה צפויה:
- ✅ כל 3 ההודעות קיימות ב-`conversations`
- ✅ עם `message_role = 'user'`

---

## צ'קליסט סופי

- [ ] `/killall` עובד ושואל אישור
- [ ] `כן` עוצר את הבוט
- [ ] `לא`/`ביטול` מבטל את העצירה
- [ ] הבוט לא מגיב ללקוחות כשעצור
- [ ] הודעות נשמרות ב-DB כשהבוט עצור
- [ ] `/activate` מפעיל את הבוט מחדש
- [ ] המנהל יכול לתקשר עם הבוט תמיד
- [ ] `/help` מציג את הפקודות החדשות
- [ ] שגיאת "כבר עצור" מוצגת נכון
- [ ] שגיאת "כבר פעיל" מוצגת נכון

---

**הערות:**
- יש לבצע את כל הבדיקות לפני deploy לפרודקשן
- רצוי לבדוק עם מספר לקוחות שונים
- לבדוק גם עם הודעות ארוכות ותמונות

