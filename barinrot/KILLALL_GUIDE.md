# מדריך: עצירת והפעלת הבוט (KILLALL/ACTIVATE)

## סקירה כללית

תכונה זו מאפשרת למנהל לעצור באופן זמני את כל התגובות של הבוט ללקוחות, תוך כדי שמירת כל ההודעות והקשר של השיחות. הבוט ממשיך להאזין להודעות ושומר אותן, וכשהוא חוזר לפעילות - הוא ממשיך את השיחות מהנקודה בה הן נעצרו.

---

## פקודות זמינות

### `/killall` - עצירת הבוט

**שימוש:** שלח את הפקודה `/killall` בצ'אט עם הבוט.

**תהליך:**
1. הבוט שולח הודעת אישור עם 3 אפשרויות:
   - `כן` - לאשר עצירת הבוט
   - `לא` - לבטל
   - `ביטול` - לבטל

2. אם נבחר `כן`:
   - ✅ הבוט עוצר מלהגיב לכל הלקוחות
   - ✅ הבוט ממשיך להאזין להודעות נכנסות
   - ✅ כל ההודעות נשמרות בהיסטוריה
   - ✅ המנהל עדיין יכול לשלוח פקודות

**דוגמה:**
```
מנהל: /killall
בוט:   ⛔ עצירת הבוט
       ─────────────────────────────
       
       ⚠️ פעולה זו תעצור את הבוט מלהגיב לכל הלקוחות!
       
       🔹 הבוט ימשיך להאזין להודעות
       🔹 השיחות יישמרו וימשכו אחרי הפעלה מחדש
       🔹 אתה תוכל להפעיל מחדש עם /activate
       
       האם אתה בטוח?
       
       כן - לעצור את הבוט
       לא - לבטל
       ביטול - לבטל

מנהל: כן
בוט:   ⛔ הבוט הופסק בהצלחה
       
       🔸 הבוט לא יגיב עכשיו לשום לקוח
       🔸 הבוט ממשיך להאזין והשיחות נשמרות
       🔸 להפעלה מחדש שלח: /activate
```

---

### `/activate` - הפעלת הבוט מחדש

**שימוש:** שלח את הפקודה `/activate` בצ'אט עם הבוט.

**תהליך:**
1. הבוט חוזר לפעילות רגילה
2. כל השיחות ממשיכות מהנקודה בה נעצרו
3. הבוט מגיב לכל ההודעות החדשות

**דוגמה:**
```
מנהל: /activate
בוט:   ✅ הבוט הופעל מחדש!
       
       🔹 הבוט חוזר להגיב לכל הלקוחות
       🔹 כל השיחות ממשיכות מהנקודה בה הן נעצרו
       
       הבוט פעיל ומוכן! 🚀
```

---

## מה קורה כשהבוט עצור?

### לקוחות:
- ❌ הבוט לא מגיב להודעות
- ✅ ההודעות נשמרות בהיסטוריית השיחה
- ✅ כשהבוט חוזר לפעילות, הוא רואה את כל ההודעות ויכול להמשיך את השיחה

### מנהל:
- ✅ המנהל יכול לשלוח פקודות ניהול
- ✅ המנהל יכול להפעיל את הבוט מחדש עם `/activate`
- ✅ המנהל יכול לראות את מצב הבוט

---

## דוגמאות שימוש

### תרחיש 1: תחזוקה מתוכננת
```
1. שולח /killall כדי לעצור את הבוט
2. מבצע תחזוקה/בדיקות/שינויים
3. שולח /activate כדי להפעיל מחדש
4. כל הלקוחות ממשיכים את השיחות שלהם
```

### תרחיש 2: בדיקת בעיה
```
1. מבחין בבעיה בתגובות הבוט
2. שולח /killall כדי לעצור זמנית
3. בודק את הלוגים/מאגר הנתונים
4. מתקן את הבעיה
5. שולח /activate להפעלה מחדש
```

### תרחיש 3: שעות לא פעילות
```
1. בסוף יום העבודה: /killall
2. הבוט לא מגיב בלילה אבל שומר הודעות
3. בתחילת יום העבודה: /activate
4. הבוט מתחיל להגיב לכל ההודעות שהצטברו
```

---

## הערות חשובות

1. **המנהל תמיד יכול לתקשר עם הבוט** - גם כשהוא עצור, המנהל יכול לשלוח פקודות
2. **ההודעות נשמרות** - כל הודעה שנשלחת כשהבוט עצור נשמרת ב-DB
3. **המשכיות שיחות** - כשהבוט חוזר לפעילות, הוא רואה את כל ההיסטוריה
4. **מצב גלובלי** - הפקודה משפיעה על כל הלקוחות בבת אחת
5. **אין צורך בהפעלה מחדש** - המצב נשמר בזיכרון, לא דורש restart של הסרבר

---

## עדכון ב-/help

הפקודות החדשות כלולות עכשיו ב-`/help`:
```
⛔ /killall - עצירת הבוט לכולם
   הבוט יפסיק להגיב לכל הלקוחות
   (ממשיך להאזין אך לא מגיב)

✅ /activate - הפעלת הבוט מחדש
   החזרת הבוט לפעילות רגילה
```

---

## קוד טכני

הקוד הבסיסי:
```javascript
// משתנה גלובלי
global.botKilled = false; // false = פעיל, true = עצור

// בדיקה לפני תגובה ללקוח
if (global.botKilled) {
    console.log(`⛔ הבוט במצב עצור - לא מגיב (אבל שומר את ההודעה)`);
    await saveConversation(sessionId, 'user', messageBody);
    return;
}
```

---

## עדכונים עתידיים אפשריים

רעיונות לשיפורים:
- [ ] הוספת לוג של מי ומתי הפעיל/עצר את הבוט
- [ ] הודעה אוטומטית ללקוחות כשהבוט עצור (אופציונלי)
- [ ] טיימר אוטומטי להפעלה מחדש
- [ ] סטטיסטיקות של כמה הודעות התקבלו כשהבוט היה עצור

---

**תאריך יצירה:** נובמבר 2025  
**גרסה:** 1.0


