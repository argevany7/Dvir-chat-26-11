# 🤖 מערכת ג'ורג' - עוזר מכירות אוטומטי לדביר בסון

## 📋 סקירה כללית

מערכת ג'ורג' היא מערכת מכירות אוטומטית מתקדמת שמשלבת בינה מלאכותית (GPT-4) עם ווטסאפ לניהול לידים וסגירת עסקאות לאימוני אומנויות לחימה של דביר בסון.

### ✨ מה השתנה?

**לפני:** מערכת מורכבת עם הרבה לוגיקה בקוד, knowledge base נפרד, config נפרד, והרבה פונקציות מסובכות.

**עכשיו:** מערכת פשוטה ונקייה שבה GPT עושה את רוב העבודה, עם פרומפט אחד מקיף שמכיל הכל.

---

## 🎯 תכונות עיקריות

### 1. **ג'ורג' - העוזר החכם**
- ג'ורג' מציג את עצמו כעוזר של דביר, לא כדביר עצמו
- מדבר בטון חברי, חם ומקצועי
- מנהל את כל התקשורת הראשונית
- עונה על שאלות ומקבע אימוני ניסיון

### 2. **מערכת דירוג לידים**
הלידים מסווגים ל-4 רמות:

```
🧊 Cold Lead (ליד קר)
↓ שלח הודעה ראשונה
↓
🔥 Warm Lead (ליד חם)
↓ נתן שם וגיל לפחות
↓
🌡️ Hot Lead (ליד רותח)
↓ קיבל קישור תשלום
↓
💰 Paid (שילם)
   אישר תשלום
```

### 3. **ניתוח אוטומטי של שיחות**
כאשר לקוח אומר "שילמתי":
1. 📊 המערכת שולחת את כל השיחה ל-GPT לניתוח
2. 🧠 GPT מחלץ מידע מובנה (שם, גיל, תאריך אימון וכו')
3. 💾 המידע נשמר למאגר הנתונים
4. 📱 נשלח סיכום אוטומטי לדביר בווטסאפ

### 4. **המרת תאריכים חכמה**
GPT מזהה תאריכים יחסיים ומהפך אותם למוחלטים:
- "שני הקרוב בשעה 18:30" → "07/10/2025 18:30"
- "חמישי בערב" → תאריך מדויק + שעה

---

## 📂 מבנה הקבצים

### קבצים פעילים:
- **`server.js`** - השרת הראשי (ברירת המחדל, מופעל עם `node server.js`)
- **`george_system_prompt.json`** - הפרומפט המקיף של ג'ורג' (מכיל הכל!)
- **`dvir_basson_clients.db`** - מאגר הנתונים
- **`index.html`** - ממשק ווב (אופציונלי)

### קבצים שגובו:
- **`server_simple_OLD_BACKUP.js`** - גיבוי של השרת הישן

---

## 🗄️ מבנה מאגר הנתונים

### טבלת `clients`
```sql
- id (מזהה ייחודי)
- phone (מספר טלפון)
- name (שם פרטי)
- full_name (שם מלא)
- age (גיל)
- experience (ניסיון קודם)
- lead_status (cold/warm/hot/paid)
- appointment_date (תאריך אימון)
- appointment_time (שעה)
- payment_confirmed (אישור תשלום)
- created_at (תאריך יצירה)
- updated_at (תאריך עדכון אחרון)
```

### טבלת `conversations`
```sql
- id
- client_phone
- message_role (user/assistant)
- message_content
- timestamp
```

### טבלת `chat_summaries`
```sql
- id
- client_phone
- summary_json (JSON עם כל הניתוח)
- created_at
```

---

## 🚀 הפעלה

### התקנה:
```bash
npm install
```

### הפעלת השרת:
```bash
node server.js
```

### גישה לממשק:
- **QR Code לווטסאפ**: http://localhost:3001/qr
- **ממשק ווב**: http://localhost:3001
- **סטטוס**: http://localhost:3001/status

---

## 💡 זרימת העבודה

### שיחה רגילה:
```
1. לקוח שולח הודעה ראשונה
   → נוצר Cold Lead במאגר

2. ג'ורג' מתחיל שיחה ואוסף מידע
   → עובר ל-Warm Lead (אחרי שם וגיל)

3. ג'ורג' שולח קישור תשלום
   → עובר ל-Hot Lead

4. לקוח אומר "שילמתי"
   → המערכת מנתחת הכל ושולחת לדביר
```

### ניתוח אוטומטי אחרי תשלום:
```json
{
  "fullName": "דני כהן",
  "name": "דני",
  "age": 28,
  "experience": "שנתיים קראטה",
  "appointmentDate": "יום חמישי הקרוב",
  "appointmentTime": "20:15",
  "appointmentDateAbsolute": "10/10/2025",
  "conversationSummary": "לקוח עם ניסיון קודם...",
  "trainingType": "MMA",
  "phoneNumber": "972501234567"
}
```

---

## 🎨 תכונות מתקדמות

### 1. **לוגיקה מינימלית**
הקוד פשוט ונקי - GPT מטפל ברוב ההחלטות:
- GPT מחליט מתי לשאול שאלות
- GPT מחליט מתי לשלוח קישור תשלום
- GPT מנתח את השיחה ומחלץ מידע

### 2. **שעות פעילות**
המערכת עונה רק בשעות פעילות:
- ראשון עד חמישי: 7:00-23:00
- שישי: 7:00-16:00
- שבת: סגור

### 3. **זיהוי תשלום חכם**
המערכת מזהה ביטויים שונים:
- **ברורים**: "שילמתי", "ביצעתי תשלום", "הכסף הועבר"
- **לא ברורים**: "עדכן", "סגרתי", "בוצע" (שואל לאישור)

### 4. **קישורי תשלום**
- ילדים/נוער (10 ש"ח): `https://letts.co.il/payment/OEVGZEpZaktQbFFSVUYrVXREMVcrdz09`
- בוגרים (25 ש"ח): `https://letts.co.il/payment/TVhqVTYxTUpCUkxHa3BTMmJmQ0YxQT09`

---

## 📊 ניטור ומעקב

### צפייה בלידים:
```bash
sqlite3 dvir_basson_clients.db "SELECT phone, name, age, lead_status, payment_confirmed FROM clients ORDER BY updated_at DESC LIMIT 10"
```

### צפייה בסיכומים:
```bash
sqlite3 dvir_basson_clients.db "SELECT client_phone, summary_json FROM chat_summaries ORDER BY created_at DESC LIMIT 5"
```

### לוגים בזמן אמת:
השרת מדפיס לוגים מפורטים:
- 📬 הודעות נכנסות
- 📤 תשובות יוצאות
- 🔥 עדכוני סטטוס לידים
- 💰 זיהויי תשלום
- 📊 ניתוחים

---

## 🔧 התאמה אישית

### עריכת הפרומפט:
1. פתח את `george_system_prompt.json`
2. ערוך את החלקים הרלוונטיים
3. הפעל מחדש את השרת

### שינוי מספר דביר:
בקובץ `server.js`, חפש:
```javascript
const dvirNumber = '972559925657@c.us';
```

### שינוי שעות פעילות:
בפונקציה `isWorkingHours()` בקובץ `server.js`

---

## 🐛 פתרון בעיות

### הבוט לא עונה?
1. בדוק שהשרת רץ: `ps aux | grep node`
2. בדוק חיבור ווטסאפ: http://localhost:3001/status
3. בדוק לוגים: `tail -f server.log` (אם קיים)

### ווטסאפ מתנתק?
1. סגור חלונות Chrome ישנים
2. נקה cache: `rm -rf /tmp/chrome-user-data`
3. הפעל מחדש את השרת

### GPT לא מנתח נכון?
1. בדוק שיש `OPENAI_API_KEY` בקובץ `.env`
2. בדוק שיש מספיק קרדיט ב-OpenAI
3. בדוק את הלוגים לשגיאות

---

## 📝 הערות חשובות

1. **גיבוי מאגר נתונים**: המאגר נשמר ב-`dvir_basson_clients.db` - גבה אותו באופן קבוע!
2. **מפתח API**: שמור את מפתח ה-OpenAI בסוד - אל תעלה אותו ל-Git
3. **שרת ישן**: הקובץ `server_simple_OLD_BACKUP.js` הוא גיבוי - אל תמחק אותו!

---

## 🎉 סיכום

מערכת ג'ורג' היא שדרוג משמעותי שמפשט את הקוד, משפר את חוויית הלקוח, ומספק ניתוח מדויק של כל שיחה.

**יתרונות המערכת החדשה:**
- ✅ קוד פשוט ונקי
- ✅ פרומפט אחד מקיף
- ✅ ניתוח אוטומטי מתקדם
- ✅ דירוג לידים ברור
- ✅ המרת תאריכים חכמה
- ✅ סיכומים אוטומטיים לדביר

---

**נוצר ב-5 באוקטובר 2025**  
**Powered by GPT-4 🚀**



