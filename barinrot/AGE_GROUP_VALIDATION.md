# מערכת בדיקת התאמת גיל לקבוצה

## סיכום השינויים

הוספתי מערכת מקיפה שמונעת מהבוט להציע קבוצות שלא מתאימות לגיל הילד/המתאמן.

## הבעיה שנפתרה

**המקרה שהיה:** אמא ביקשה לילד בכיתה ג' (בן 8-9) אימון איגרוף תאילנדי בשלישי, והבוט הציע קבוצת נוער - זה לא מתאים ומסוכן!

**הפתרון:** הבוט עכשיו יבין שאין אגרוף תאילנדי לגיל 8-9, ויציע במקום MMA בשני וחמישי בקבוצה המתאימה לגיל.

## מה נוסף למערכת

### 1. פונקציה להערכת גיל לפי כיתה
```javascript
estimateAgeFromGrade(grade)
```
- מקבלת כיתה (א', ב', ג', 1, 2, 3, "כיתה ג", וכו')
- מחזירה גיל משוער (כיתה ג' = גיל 9)
- תומכת בפורמטים שונים: עברית, מספרים, עם/בלי גרש

**דוגמאות:**
- `estimateAgeFromGrade('ג')` → 9
- `estimateAgeFromGrade(3)` → 9
- `estimateAgeFromGrade('כיתה ג')` → 9

### 2. פונקציה לקבלת קבוצת גיל מתאימה
```javascript
getAgeGroup(age, trainingType)
```
- מקבלת גיל וסוג אימון (MMA או תאילנדי)
- מחזירה את קבוצת הגיל המתאימה עם ימים ושעות
- מחזירה `null` אם אין קבוצה מתאימה

**דוגמאות:**
- `getAgeGroup(8, 'MMA')` → קבוצת 6-9, שני וחמישי 17:45-18:30
- `getAgeGroup(8, 'תאילנדי')` → `null` (אין אגרוף תאילנדי לגיל 8)
- `getAgeGroup(13, 'תאילנדי')` → קבוצת נוער 12-16, שלישי 18:30-19:30

### 3. פונקציה לבדיקת התאמה
```javascript
isAgeAppropriateForGroup(age, requestedDay, requestedTime, trainingType)
```
- בודקת אם גיל מסוים מתאים ליום ושעה שהלקוח מבקש
- מחזירה אובייקט עם `appropriate: true/false` וסיבה
- מציעה קבוצה חלופית אם לא מתאים

**דוגמאות:**
- ילד בן 9 מבקש תאילנדי בשלישי → `appropriate: false`, "אין קבוצה מתאימה"
- ילד בן 14 מבקש MMA בשני → `appropriate: true`

## עדכון ה-System Prompt

### הוספה ל-`ariel_system_prompt.json`
נוסף כלל חדש `age_group_matching` ב-`special_rules`:

**מה זה כולל:**
- טבלת קבוצות גיל ל-MMA ואגרוף תאילנדי
- כלל להערכת גיל מכיתה
- הוראות מפורשות מה לעשות כשהלקוח מבקש משהו לא מתאים
- דוגמה למקרה בעייתי ואיך להגיב

**תגובה מומלצת כשלא מתאים:**
```
"מבין שהיית רוצה ביום שלישי, אבל לצערי לגיל הזה אין אימון איגרוף תאילנדי. 
יש לנו MMA מעולה בשני וחמישי בשעה שמתאימה לגיל - זה יהיה הרבה יותר טוב בשבילו 😊"
```

### הוספה ל-`server.js`
נוסף קטע חדש ב-system prompt המועבר ל-GPT:

```
🚨🚨🚨 כלל קריטי - התאמת גיל לקבוצה 🚨🚨🚨

⚠️ חובה מוחלטת: אסור להציע קבוצה שלא מתאימה לגיל הילד/המתאמן!
```

הכולל:
- טבלת קבוצות גיל מפורטת
- כלל זהב עם 3 נקודות עיקריות
- דוגמה מפורשת למקרה בעייתי והתגובה הנכונה

## קבוצות הגיל

### MMA (שני וחמישי)
- **4-6 שנים:** 17:00-17:45
- **6-9 שנים:** 17:45-18:30
- **9-12 שנים:** 18:30-19:15
- **12-16 שנים (נוער):** 19:15-20:15
- **16+ (בוגרים):** 20:15-21:15

### אגרוף תאילנדי (שלישי)
- **12-16 שנים (נוער):** 18:30-19:30
- **16+ (בוגרים):** 19:30-20:30
- **⚠️ אין אגרוף תאילנדי לילדים מתחת לגיל 12!**

## איך הבוט יתנהג עכשיו

### תרחיש 1: הורה מזכיר כיתה
**לקוח:** "הבן שלי בכיתה ג'"

**הבוט יעשה:**
1. יעריך גיל בראש: כיתה ג' ≈ 8-9 שנים
2. ישאל לאישור בנימוס: **"זה אומר שהוא בן 8-9, נכון?"** או **"אז הוא בן כמה בדיוק?"**
3. ⚠️ **חשוב:** הבוט ימתין לתשובת ההורה ולא יציע שום קבוצה לפני אישור הגיל!
4. רק אחרי שההורה מאשר את הגיל - יציע קבוצות מתאימות
5. אם ההורה מתקן (למשל: "לא, הוא בן 10") - הבוט ישתמש בגיל שההורה אמר

**דוגמה לשיחה נכונה:**
```
הורה: הבן שלי בכיתה ג'
אריאל: זה אומר שהוא בן 8-9, נכון?
הורה: כן, הוא בן 9
אריאל: (עכשיו ממשיך עם גיל 9)
```

**למה חשוב?** ילד יכול להיות שנשאר בכיתה, דילג כיתה, או פשוט גיל שונה מהצפוי.

### תרחיש 2: לקוח מבקש משהו לא מתאים
**לקוח:** "אני רוצה שהבן שלי בן 9 יבוא לאגרוף תאילנדי בשלישי"

**הבוט יגיד:**
```
מבין שהיית רוצה ביום שלישי, אבל לצערי לגיל הזה אין אימון איגרוף תאילנדי. 
יש לנו MMA מעולה בשני וחמישי בשעה 18:30-19:15 שמתאימה לגיל שלו - 
זה יהיה הרבה יותר טוב בשבילו 💪
```

### תרחיש 3: כל השאר תקין
**לקוח:** "הבן שלי בן 14, רוצה MMA"

**הבוט יציע:**
- קבוצת נוער 12-16
- שני וחמישי 19:15-20:15
- הכל תקין! ✅

## הכללים החדשים

### ✅ כלל 1: תמיד הערכת גיל מכיתה + וידוא מול ההורה
⚠️⚠️⚠️ **חובה מוחלטת:** אסור להשתמש בגיל משוער לפני אישור!

**תהליך נכון:**
1. הורה אומר "כיתה X"
2. הבוט מעריך את הגיל בראש (כיתה ג' = 8-9)
3. הבוט שואל לאישור: "זה אומר שהוא בן 8-9, נכון?"
4. הבוט ממתין לתשובת ההורה
5. רק אחרי אישור - הבוט משתמש בגיל להמלצות
6. אם ההורה מתקן - הבוט משתמש בגיל שההורה אמר

**למה?** ילד יכול להיות שנשאר בכיתה, דילג כיתה, או גיל שונה מהצפוי.

### ✅ כלל 2: בדיקת התאמה לפני המלצה
לפני כל המלצה על קבוצה/יום/שעה - הבוט יבדוק שהגיל מתאים.

### ✅ כלל 3: אסור להתפשר על בטיחות
אסור לרשום ילד לקבוצת נוער/בוגרים כי "זה היום היחיד שמתאים" - זה מסוכן!

### ✅ כלל 4: הסבר מכובד כשלא מתאים
אם אין התאמה - הבוט יסביר בצורה מכובדת ויציע חלופה טובה יותר.

## בדיקות שבוצעו

הרצתי בדיקות אוטומטיות שאימתו:
- ✅ הערכת גיל מכיתה עובדת נכון
- ✅ זיהוי קבוצת גיל המתאימה עובד
- ✅ המקרה הבעייתי (ילד 9 + תאילנדי) נתפס נכון
- ✅ בדיקת התאמה עובדת עבור כל הגילאים

## סיכום

המערכת עכשיו:
1. ✅ מבינה כיתות ומעריכה גיל
2. ✅ **מבקשת אישור מההורה על הגיל לפני שמשתמשת בו** 🆕
3. ✅ ממתינה לאישור ולא מציעה קבוצות לפני זה 🆕
4. ✅ בודקת התאמת גיל לקבוצה לפני כל המלצה
5. ✅ לא תציע קבוצות לא מתאימות
6. ✅ תסביר בצורה מכובדת כשמשהו לא מתאים
7. ✅ תציע חלופות מתאימות

**זה פותר את הבעיה שתיארת - הבוט לא ירשום ילדים לקבוצות שלא מתאימות להם מבחינת גיל!**

---
תאריך: 29 אוקטובר 2025

