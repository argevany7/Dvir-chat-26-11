# 🚫 מדריך ניהול מספרים חסומים

## תיאור
פיצ'ר זה מאפשר לדביר לשלוט על אילו לקוחות הבוט יגיב אליהם.  
**שימוש עיקרי**: כאשר לקוח הופך ללקוח משלם, דביר חוסם אותו כדי שהבוט לא ימשיך לענות לו.

---

## 📱 פקודות זמינות למנהלים (0559925657, 050-842-2092)

### 1️⃣ חסימת מספר - `/block`
**תיאור**: חוסם מספר טלפון כך שהבוט לא יגיב עוד להודעות ממנו. המערכת תבקש גם את שם איש הקשר.

**שימוש**:
```
/block 0501234567
```

**דוגמאות**:
- `/block 0501234567`
- `/block 972501234567`
- `/block 501234567`

**תשובת הבוט** (שלב 1):
```
מספר הטלפון: 972501234567

מה שם איש הקשר? 👤

(פשוט כתוב את השם המלא)
```

**אתה עונה**: משה כהן

**תשובת הבוט** (שלב 2):
```
✅ המספר נחסם בהצלחה!

👤 שם: משה כהן
📞 מספר: 972501234567

הבוט לא יגיב יותר להודעות מהמספר הזה.
```

---

### 2️⃣ בדיקת מספרים חסומים - `/check`
**תיאור**: מציג רשימה של כל המספרים החסומים כרגע.

**שימוש**:
```
/check
```

**תשובת הבוט** (אם יש מספרים חסומים):
```
📋 רשימת מספרים חסומים (3):

1. 📞 0501234567
   סיבה: לקוח משלם
   תאריך: 21/10/2025

2. 📞 0527654321
   סיבה: לקוח משלם
   תאריך: 20/10/2025

3. 📞 0546789012
   סיבה: לקוח משלם
   תאריך: 19/10/2025

💡 להסרת חסימה: /unblock [מספר]
```

**תשובת הבוט** (אם אין מספרים):
```
📋 אין מספרים חסומים כרגע.

הבוט עונה לכל המספרים.
```

---

### 3️⃣ הסרת חסימה - `/unblock`
**תיאור**: מסיר חסימה ממספר טלפון כך שהבוט יחזור לענות לו. יש להזין את המספר הסידורי מתוך הרשימה.

**שימוש**:
```
/unblock 1
```

**דוגמה**:
קודם שלח `/check` לראות את הרשימה:
```
📋 רשימת לקוחות חסומים (2)

1. 👤 משה כהן
   📞 972501234567
   📅 21/10/2025

2. 👤 דוד לוי
   📞 972527654321
   📅 20/10/2025
```

אחר כך שלח `/unblock 1` כדי להסיר את משה כהן.

**תשובת הבוט**:
```
✅ החסימה הוסרה בהצלחה

👤 משה כהן
📞 972501234567

הבוט יכול עכשיו לענות להודעות מהמספר הזה
```

---

### 4️⃣ עזרה - `/help`
**תיאור**: מציג רשימת פקודות זמינות.

**שימוש**:
```
/help
```

---

## 🔄 תהליך עבודה מומלץ

### תרחיש: לקוח הפך ללקוח משלם

1. **לקוח שילם** → מערכת הבוט שולחת למנהלים סיכום
2. **המנהל מתחיל לדבר עם הלקוח** ישירות בווטסאפ
3. **המנהל חוסם את המספר**:
   ```
   /block 0501234567
   ```
   ואז כותב את שם הלקוח כשהמערכת מבקשת
4. **הבוט לא יגיב יותר** להודעות מהלקוח הזה
5. **המנהל מדבר עם הלקוח** בעצמו ללא הפרעות

---

## 🗄️ מאגר נתונים

המערכת שומרת את המספרים החסומים בטבלה חדשה בדאטאבייס:
- **שם הטבלה**: `blocked_contacts`
- **שדות**:
  - `phone` - מספר הטלפון החסום
  - `blocked_by` - מי חסם (בדרך כלל "דביר")
  - `reason` - סיבת החסימה (בדרך כלל "לקוח משלם")
  - `created_at` - תאריך החסימה

---

## 🔒 אבטחה

- **רק המנהלים** (מספרים 972559925657 ו-972508422092) יכולים להשתמש בפקודות האלה
- אם מישהו אחר ינסה לשלוח `/kill` או `/check` - הבוט לא יגיב
- המערכת שומרת לוג מלא של כל פעולות החסימה

---

## 📝 הערות חשובות

1. **פורמט מספר טלפון**: המערכת מתחשבת רק בספרות, אז כל הפורמטים הבאים תקינים:
   - `0501234567`
   - `972501234567`
   - `+972-50-123-4567`
   - `050-123-4567`

2. **חסימה מיידית**: ברגע שמספר נחסם, הבוט מפסיק לענות לו באופן מיידי

3. **אין השפעה על היסטוריה**: החסימה לא מוחקת את ההיסטוריה של השיחות עם הלקוח

4. **ניתן להסיר חסימה**: אפשר תמיד להסיר חסימה עם `/unblock`

---

## 🛠️ טכני - איך זה עובד?

1. כל הודעה נכנסת עוברת בדיקה אם השולח חסום
2. אם השולח חסום → הבוט לא מגיב (בלי הודעת שגיאה)
3. אם השולח לא חסום → הבוט מעבד את ההודעה כרגיל
4. רק דביר יכול לראות את רשימת החסומים ולנהל אותה

---

## 💡 שאלות נפוצות

**Q: מה קורה אם דביר שולח `/kill` על מספר שכבר חסום?**  
A: המערכת עושה `INSERT OR REPLACE`, כך שאין שגיאה - פשוט מתעדכן התאריך.

**Q: מה קורה אם לקוח חסום שולח הודעה?**  
A: הבוט פשוט מתעלם מההודעה. הלקוח לא מקבל אינדיקציה שהוא חסום.

**Q: האם החסימה מסתנכרנת בין מכשירים?**  
A: כן, החסימה נשמרת במאגר הנתונים ועובדת על כל מכשיר שמריץ את הבוט.

**Q: כמה מספרים אפשר לחסום?**  
A: אין הגבלה. המערכת תומכת במספר בלתי מוגבל של חסימות.

---

## 🎯 סיכום

פיצ'ר זה מאפשר לדביר:
- ✅ לחסום לקוחות משלמים כדי לדבר איתם ישירות
- ✅ לראות רשימת לקוחות חסומים
- ✅ להסיר חסימה בקלות אם צריך
- ✅ לשמור על ארגון נקי של הלידים

---

**נוצר ב-21/10/2025**  
**גרסה 1.0**



