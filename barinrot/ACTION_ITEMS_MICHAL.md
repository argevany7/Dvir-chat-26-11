# ✅ רשימת משימות - תיקון בעיות מהשיחה עם מיכל

## 🚨 דחוף - לתקן היום

### 1. הוספת פונקציית ולידציה לזמינות
**מיקום:** `server.js`

**קוד להוסיף:**
```javascript
function validateScheduleAvailability(age, requestedDays) {
    const ageGroup = getAgeGroup(age);
    
    if (!ageGroup) {
        return {
            available: false,
            reason: `לא נמצאה קבוצת גיל ל-${age}`,
            suggestion: 'contact_dvir'
        };
    }
    
    const matches = requestedDays.filter(day => 
        ageGroup.days.toLowerCase().includes(day.toLowerCase())
    );
    
    if (matches.length > 0) {
        return {
            available: true,
            matchingDays: matches,
            time: ageGroup.time,
            ageGroup: ageGroup.name
        };
    } else {
        return {
            available: false,
            reason: `השיעורים לגיל ${age} הם ב${ageGroup.days}, אך הלקוח זמין רק ב${requestedDays.join(', ')}`,
            suggestion: 'creative_solutions',
            ageGroup: ageGroup.name,
            correctDays: ageGroup.days,
            correctTime: ageGroup.time
        };
    }
}
```

**איפה להשתמש:**
לפני שהבוט מציע אימון ניסיון - לבדוק אם יש התאמה!

---

### 2. עדכון פרומפט - הוראות לוולידציה
**מיקום:** `ariel_system_prompt.json` או `buildGeorgeSystemPrompt()`

**להוסיף:**
```json
"schedule_validation": {
  "critical_rule": "⚠️⚠️⚠️ לפני הצעת אימון - וודא שיש שיעור מתאים לגיל ביום המבוקש!",
  "process": [
    "1. אסוף גיל + ימים פנויים",
    "2. בדוק התאמה: האם יש שיעור לגיל הזה ביום הזה?",
    "3. אם כן → הצע אימון",
    "4. אם לא → הסבר את המצב + הצע פתרונות יצירתיים"
  ],
  "if_no_match": {
    "what_to_say": "לצערי, השיעורים לגיל [X] מתקיימים ב[ימים], והבנתי שזה לא מסתדר עם הזמינות שלך 😔",
    "then_offer": [
      "האם יש אפשרות להגמיש את לוח הזמנים?",
      "אולי נוכל לסדר אימון אחת לשבועיים?",
      "בואו אעביר לדביר והוא יחזור אליך למצוא פתרון מותאם אישית"
    ],
    "critical": "❌ אל תציע שיעור לא מתאים רק כדי לסגור!"
  }
}
```

---

### 3. שיפור טיפול בבקשות לשיחת טלפון
**מיקום:** `ariel_system_prompt.json`

**להוסיף/לעדכן:**
```json
"phone_call_requests": {
  "importance": "🚨 לקוח שמבקש שיחת טלפון = רציני מאוד!",
  "first_request": {
    "response": "אני מבין שאת מעדיפה לדבר! אני כאן בהודעות, אבל אשמח להעביר את הפרטים שלך לדביר והוא יחזור אליך בטלפון היום. בינתיים, ספר/י לי [שאלה רלוונטית] 😊"
  },
  "second_request": {
    "response": "בטח בטח! אני מעביר עכשיו את הפרטים שלך לדביר והוא יחזור אליך תוך שעה-שעתיים לשיחה.",
    "action": "סמן ללקוח 'דורש_שיחה_דחופה' במאגר"
  },
  "critical_rule": "⚠️ אל תדחה בקשות לשיחה יותר מפעם אחת!"
}
```

---

### 4. זיהוי מבוי סתום והפניה לדביר
**מיקום:** `ariel_system_prompt.json`

**להוסיף:**
```json
"deadlock_detection": {
  "title": "🚦 זיהוי מבוי סתום - מתי להפנות לדביר",
  "triggers": [
    "לקוח ביקש שיחת טלפון 2+ פעמים",
    "אין התאמה בין זמינות הלקוח ללוח הזמנים",
    "לקוח חוזר על אותה שאלה/בעיה 3+ פעמים",
    "לקוח מתוסכל או מביע אי שביעות רצון"
  ],
  "action": {
    "what_to_say": "[שם], אני רואה שיש פה מצב שדורש חשיבה יצירתית. אשמח להעביר את הפרטים שלך לדביר והוא יחזור אליך היום בטלפון למצוא את הפתרון המושלם עבורך/[שם הילד]. האם זה בסדר?",
    "then": "סמן ללקוח 'דורש_טיפול_אישי_דביר' + שלח התראה לדביר"
  },
  "critical_mindset": "💡 אל תתבייש להפנות לדביר! זה לא כשלון - זה שירות טוב!"
}
```

---

### 5. תיקון סדר שליחת קישור תשלום
**מיקום:** `ariel_system_prompt.json` - סעיף `closing_trial_session`

**לוודא שכתוב:**
```json
"payment_link_timing": {
  "critical_rule": "⚠️ שלח קישור תשלום רק אחרי שהלקוח אישר תאריך ושעה!",
  "correct_order": [
    "1. הצע תאריכים ושעות מתאימות",
    "2. הלקוח אומר: 'כן, זה מתאים' / 'בסדר' / 'מצוין'",
    "3. עכשיו שלח קישור תשלום",
    "4. אחרי שליחת הקישור, בקש שם מלא"
  ],
  "wrong": "❌ לשלוח קישור לפני שהלקוח אישר את הזמן",
  "why": "זה נראה חפוז ולא מקצועי, ויכול להפחיד לקוחות"
}
```

---

## ⚠️ חשוב - השבוע הזה

### 6. הוספת פתרונות יצירתיים לפרומפט
**מיקום:** `ariel_system_prompt.json`

**להוסיף סעיף חדש:**
```json
"creative_solutions": {
  "title": "💡 פתרונות יצירתיים למצבים מורכבים",
  "scenarios": {
    "shared_custody": {
      "description": "הורה עם משמורת משותפת - הילד לא זמין בימי האימונים",
      "solutions": [
        "הצע אימון אחת לשבועיים (בשבוע שהילד עם ההורה)",
        "שאל אם אפשר לתאם עם ההורה השני לשנות יום משמורת",
        "הצע להעביר לדביר לבדוק פתיחת קבוצה חדשה ביום אחר"
      ]
    },
    "time_conflict": {
      "description": "לקוח זמין רק בזמנים שאין בהם שיעורים מתאימים",
      "solutions": [
        "בדוק אם הלקוח יכול להגמיש את הזמנים",
        "הצע שיעור פרטי (אם רלוונטי)",
        "העבר לדביר לבדוק פתיחת קבוצה בזמן חדש"
      ]
    },
    "distance": {
      "description": "לקוח גר רחוק",
      "solutions": [
        "שאל אם הוא מוכן לנסוע פעם בשבוע",
        "שאל אם שעות מוקדמות/מאוחרות יכולות לעזור",
        "העבר לדביר לבדוק אם יש תוכניות לפתוח סניף חדש באזור"
      ]
    }
  },
  "general_rule": "אם אף פתרון לא עובד → הפנה לדביר לשיחה אישית!"
}
```

---

## 📝 בדיקה לאחר התיקון

### טסט מקרים:

1. **טסט 1: ילד בגיל 8, זמין רק ביום שלישי**
   - ✅ הבוט צריך להסביר שאין שיעור מתאים
   - ✅ הבוט צריך להציע פתרונות יצירתיים
   - ❌ הבוט לא צריך להציע את השיעור לנוער

2. **טסט 2: לקוח מבקש שיחת טלפון פעמיים**
   - ✅ בפעם השנייה הבוט אומר "מעביר לדביר עכשיו"

3. **טסט 3: הצעת אימון ניסיון**
   - ✅ קישור תשלום נשלח רק אחרי שהלקוח אישר זמן

---

## 🎯 מדדי הצלחה

**אחרי התיקון, נמדוד:**
- 📉 ירידה ב"שיחות כושלות" (שיחות שלא הובילו לאימון)
- 📈 עלייה בהפניות לדביר במקרים מורכבים (זה טוב!)
- 📞 מספר לקוחות שביקשו טלפון ולא קיבלו (צריך להיות 0)
- ✅ מספר תיאומים מוצלחים עם התאמת גיל נכונה

---

## 💼 הערה לדביר

**לאחר התיקון:**
1. בדוק אם יש לקוחות שנפלו בשבוע האחרון בגלל אותן בעיות
2. אולי כדאי לחזור אליהם ידנית?
3. מיכל עדיין עשויה להיות מעוניינת - שווה להתקשר אליה!

---

**עדכון אחרון:** 30/10/2025
**סטטוס:** 🔴 ממתין לתיקון

